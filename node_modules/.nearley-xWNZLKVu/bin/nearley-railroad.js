#!/usr/bin/env node

try {
  var rr = require('railroad-diagrams');
} catch(e) {
  // optional dependency not fullfilled
  console.log('Error: When you installed nearley, the dependency "railroad-diagrams" failed to install. Try running "npm install -g nearley" to re-install nearley. If that doesn\'t fix the problem, please file an issue on the nearley GitHub repository.')
  process.exit(1)
}

var fs = require('fs');
var path = require('path');
var opts = require('commander');

var version = require('../package.json').version;
opts.version(version, '-v, --version')
    .arguments('<file.ne>')
    .option('-o, --out [filename.svg]', 'File to output to (default stdout).', false)
    .parse(process.argv);

var input = opts.args[0] ? fs.createReadStream(opts.args[0]) : process.stdin;
var output = opts.out ? fs.createWriteStream(opts.out) : process.stdout;

function railroad(grm) {
    var rules = {};
    grm.forEach(function(instr) {
        if (instr.rules) {
            if (!rules[instr.name]) {
               